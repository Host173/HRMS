@model IEnumerable<HRMS.Models.Contract>
@{
    ViewData["Title"] = "Contracts Expiring Soon";
}

<div style="margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <div>
            <h2 style="font-size: 1.75rem; margin-bottom: 0.5rem;">Contracts Expiring Soon</h2>
            <p class="text-muted">Contracts expiring within the next 30 days</p>
        </div>
        <a asp-action="Index" class="btn-premium btn-secondary">
            Back to All Contracts
        </a>
    </div>
</div>

<div class="premium-card">
    @if (Model != null && Model.Any())
    {
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;">
            @foreach (var contract in Model)
            {
                var daysRemaining = contract.end_date.HasValue 
                    ? (contract.end_date.Value.ToDateTime(TimeOnly.MinValue) - DateTime.UtcNow).Days 
                    : 0;
                var urgencyColor = daysRemaining <= 7 ? "#dc2626" : daysRemaining <= 14 ? "#d97706" : "#15803d";
                var urgencyBg = daysRemaining <= 7 ? "rgba(239, 68, 68, 0.1)" : daysRemaining <= 14 ? "rgba(217, 119, 6, 0.1)" : "rgba(34, 197, 94, 0.1)";
                
                <div class="premium-card" style="border-left: 4px solid @urgencyColor;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                        <div>
                            <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem;">@contract.type</h3>
                            @if (contract.Employee.Any())
                            {
                                <div style="font-size: 0.9rem; color: var(--color-text-secondary);">
                                    @contract.Employee.First().full_name
                                </div>
                            }
                        </div>
                        <span style="background: @urgencyBg; color: @urgencyColor; padding: 0.25rem 0.75rem; border-radius: var(--radius-sm); font-size: 0.85rem; font-weight: 500;">
                            @daysRemaining day(s) left
                        </span>
                    </div>

                    <div style="margin-bottom: 1rem; padding: 1rem; background: var(--color-bg-secondary); border-radius: var(--radius-md);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.9rem;">
                            <div>
                                <div style="color: var(--color-text-secondary); margin-bottom: 0.25rem;">Start Date</div>
                                <div style="font-weight: 500;">@(contract.start_date?.ToString("MMM dd, yyyy") ?? "N/A")</div>
                            </div>
                            <div>
                                <div style="color: var(--color-text-secondary); margin-bottom: 0.25rem;">End Date</div>
                                <div style="font-weight: 500; color: @urgencyColor;">@(contract.end_date?.ToString("MMM dd, yyyy") ?? "N/A")</div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 0.5rem;">
                        <a asp-action="Details" asp-route-id="@contract.contract_id" class="btn-premium btn-secondary" style="flex: 1; text-align: center; padding: 0.5rem;">
                            View Details
                        </a>
                        <a asp-action="Renew" asp-route-id="@contract.contract_id" class="btn-premium btn-primary" style="flex: 1; text-align: center; padding: 0.5rem;">
                            Renew
                        </a>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div style="text-align: center; padding: 3rem;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--color-text-secondary); margin: 0 auto 1rem;">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <p style="color: var(--color-text-secondary); margin-bottom: 1rem;">No contracts expiring in the next 30 days.</p>
            <a asp-action="Index" class="btn-premium btn-secondary">
                View All Contracts
            </a>
        </div>
    }
</div>

