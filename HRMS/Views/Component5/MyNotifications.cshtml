@model List<HRMS.Models.NotificationViewModel>
@{
    ViewData["Title"] = "My Notifications";
}

<div class="premium-card" style="margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h1 style="margin: 0; color: var(--color-text-primary);">My Notifications</h1>
        <div style="display: flex; gap: 0.5rem;">
            @if (Model != null && Model.Any(n => !n.IsRead))
            {
                <form asp-controller="Component5" asp-action="MarkAllAsRead" method="post" style="display: inline;">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn-premium btn-secondary" style="padding: 0.5rem 1rem;">
                        Mark All as Read
                    </button>
                </form>
            }
            @if (ViewBag.CanSendNotifications == true)
            {
                <a asp-controller="Component5" asp-action="SendNotification" class="btn-premium btn-primary" style="padding: 0.5rem 1rem;">
                    Send Notification
                </a>
            }
        </div>
    </div>

    @if (TempData["ErrorMessage"] != null)
    {
        <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid var(--color-error); color: #dc2626; padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;" role="alert">
            @TempData["ErrorMessage"]
        </div>
    }

    @if (Model == null || !Model.Any())
    {
        <div style="text-align: center; padding: 3rem; color: var(--color-text-secondary);">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin: 0 auto 1rem; opacity: 0.5;">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <p style="font-size: 1.1rem; margin: 0;">No notifications found.</p>
        </div>
    }
    else
    {
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            @foreach (var notification in Model)
            {
                <div class="premium-card" style="padding: 1.5rem; border-left: 4px solid @(notification.Urgency == "High" ? "#ef4444" : notification.Urgency == "Medium" ? "#f59e0b" : "#3b82f6"); 
                     background: @(notification.IsRead ? "var(--color-bg-secondary)" : "var(--color-bg-primary)");">
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                @if (!notification.IsRead)
                                {
                                    <span style="display: inline-block; width: 8px; height: 8px; background: var(--color-primary); border-radius: 50%;"></span>
                                }
                                <span style="font-weight: 600; color: var(--color-text-primary);">@notification.MessageContent</span>
                            </div>
                            <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: var(--color-text-secondary);">
                                @if (notification.Timestamp.HasValue)
                                {
                                    <span>üìÖ @notification.Timestamp.Value.ToString("MMM dd, yyyy HH:mm")</span>
                                }
                                @if (!string.IsNullOrEmpty(notification.NotificationType))
                                {
                                    <span>üè∑Ô∏è @notification.NotificationType</span>
                                }
                                @if (!string.IsNullOrEmpty(notification.Urgency))
                                {
                                    <span>‚ö° @notification.Urgency</span>
                                }
                            </div>
                        </div>
                        @if (!notification.IsRead)
                        {
                            <form asp-controller="Component5" asp-action="MarkAsRead" method="post" style="display: inline;">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="notificationId" value="@notification.NotificationId" />
                                <button type="submit" class="btn-premium btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                                    Mark as Read
                                </button>
                            </form>
                        }
                    </div>
                </div>
            }
        </div>
    }
</div>
