@model HRMS.Models.HierarchyNodeViewModel

<div class="org-chart-node" data-level="@Model.Level" data-employee-name="@Model.EmployeeName?.ToLower()" 
     data-position="@Model.Position?.ToLower()" data-department="@Model.Department?.ToLower()">
    <div class="org-card org-card-level-@Model.Level" data-expanded="true">
        <div class="org-card-gradient"></div>
        <div class="org-card-content">
            <div class="org-card-header">
                <div class="org-avatar-wrapper">
                    <div class="org-avatar org-avatar-level-@Model.Level">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    @{
                        var badgeText = "";
                        var badgeClass = "";
                        
                        if (Model.Roles != null && Model.Roles.Any())
                        {
                            if (Model.Roles.Contains("System Administrator"))
                            {
                                badgeText = "Admin";
                                badgeClass = "org-badge-admin";
                            }
                            else if (Model.Roles.Contains("HR Administrator"))
                            {
                                badgeText = "HR";
                                badgeClass = "org-badge-hr";
                            }
                            else if (Model.Roles.Contains("Line Manager"))
                            {
                                badgeText = "Manager";
                                badgeClass = "org-badge-manager";
                            }
                            else if (Model.Level == 0 && !string.IsNullOrEmpty(Model.Position))
                            {
                                // For root level, show position if no special role
                                badgeText = Model.Position.Length > 8 ? Model.Position.Substring(0, 8) + "..." : Model.Position;
                                badgeClass = "org-badge-position";
                            }
                        }
                        else if (Model.Level == 0)
                        {
                            // Fallback for root level with no roles
                            badgeText = "CEO";
                            badgeClass = "org-badge-ceo";
                        }
                    }
                    
                    @if (!string.IsNullOrEmpty(badgeText))
                    {
                        <div class="org-badge @badgeClass">@badgeText</div>
                    }
                </div>
                <div class="org-card-info">
                    <div class="org-name">@Model.EmployeeName</div>
                    <div class="org-meta">
                        @if (!string.IsNullOrEmpty(Model.Position))
                        {
                            <div class="org-meta-item org-position">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                <span>@Model.Position</span>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(Model.Department))
                        {
                            <div class="org-meta-item org-department">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                                <span>@Model.Department</span>
                            </div>
                        }
                    </div>
                </div>
            </div>
            @if (Model.Subordinates.Any())
            {
                <div class="org-subordinates-badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span class="org-team-count">@Model.Subordinates.Count</span>
                    <span class="org-team-label">@(Model.Subordinates.Count == 1 ? "Member" : "Members")</span>
                    <button class="org-toggle-btn" type="button" aria-label="Toggle team">
                        <svg class="org-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                </div>
            }
        </div>
    </div>
    
    @if (Model.Subordinates.Any())
    {
        <div class="org-chart-children" data-expanded="true">
            @foreach (var subordinate in Model.Subordinates)
            {
                <div class="org-chart-child-wrapper">
                    <div class="org-connector-line"></div>
                    @await Html.PartialAsync("_HierarchyNode", subordinate)
                </div>
            }
        </div>
    }
</div>

